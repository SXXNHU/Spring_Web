# ìŠ¤í”„ë§ ì…ë¬¸ ì •ë¦¬ #9

# âœ” ëª©í‘œ
JPA ëŒ€í•´ ê³µë¶€í•´ë³´ì.

<br/>

# âœ” ëª©ì°¨
* JPA
* í™˜ê²½ì„¤ì •
* JPA ì—”í‹°í‹° ë§¤í•‘
* JPA íšŒì› ë¦¬í¬ì§€í† ë¦¬
* ì„œë¹„ìŠ¤ ê³„ì¸µì— íŠ¸ëœì­ì…˜ ì¶”ê°€
* JPAë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìŠ¤í”„ë§ ì„¤ì • ë³€ê²½

<br/>

# ğŸ’¡ 9-1 JPA

* JPAëŠ” ê¸°ì¡´ì˜ ë°˜ë³µ ì½”ë“œëŠ” ë¬¼ë¡ ì´ê³ , ê¸°ë³¸ì ì¸ SQLë„ JPAê°€ ì§ì ‘ ë§Œë“¤ì–´ì„œ ì‹¤í–‰í•´ì¤€ë‹¤.
* JPAë¥¼ ì‚¬ìš©í•˜ë©´, SQLê³¼ ë°ì´í„° ì¤‘ì‹¬ì˜ ì„¤ê³„ì—ì„œ ê°ì²´ ì¤‘ì‹¬ì˜ ì„¤ê³„ë¡œ íŒ¨ëŸ¬ë‹¤ì„ì„ ì „í™˜ì„ í•  ìˆ˜ ìˆë‹¤.
* JPAë¥¼ ì‚¬ìš©í•˜ë©´ ê°œë°œ ìƒì‚°ì„±ì„ í¬ê²Œ ë†’ì¼ ìˆ˜ ìˆë‹¤
* JPAëŠ” í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ì´ë©° êµ¬í˜„ì²´ëŠ” ì—¬ëŸ¬ ì—…ì²´ë“¤ì´ ìˆëŠ”ë°, ì„±ëŠ¥ê³¼ íŠ¹ì§•ì´ ëª¨ë‘ ë‹¤ë¥´ë‹¤. ì£¼ë¡œ í•˜ì´ë²„ë„¤ì´íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤.
* ì„¸ê³„ì ìœ¼ë¡œ mybatisë³´ë‹¤ ë” ë§ì´ ì“°ì´ëŠ” ê¸°ìˆ ì´ë‹¤.

<br/>

# ğŸ’¡ 9-2 í™˜ê²½ì„¤ì •

## **build.gradle**

```java
dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
	runtimeOnly 'com.h2database:h2'
	compileOnly 'org.projectlombok:lombok'
	annotationProcessor 'org.projectlombok:lombok'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
}
```

`implementation 'org.springframework.boot:spring-boot-starter-data-jpa'`ë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.

`spring-boot-starter-data-jpa`ëŠ” jdbc ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ í¬í•¨í•œë‹¤.

<br/>

## **resources/application.properties**

```java
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa

spring.jpa.show-sql=true
spring.jpa.hibernate.ddl-auto=none
```

* `show-sql` : JPAê°€ ìƒì„±í•˜ëŠ” SQLì„ ì¶œë ¥í•œë‹¤.
* `ddl-auto` : JPAëŠ” í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ë° none ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ ê¸°ëŠ¥ì„ ëˆë‹¤. create ë¥¼ ì‚¬ìš©í•˜ë©´ ì—”í‹°í‹° ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í…Œì´ë¸”ë„ ì§ì ‘ ìƒì„±í•´ì¤€ë‹¤.

<br/>

# ğŸ’¡ 9-3 JPA ì—”í‹°í‹° ë§¤í•‘

## **Member**

```java
//JPAê°€ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°ë¼ëŠ” ê²ƒì„ ì„¤ì •í•˜ëŠ” ì• ë…¸í…Œì´ì…˜. í…Œì´ë¸”ê³¼ ë§¤í•‘ëœë‹¤.
@Entity
public class Member {

    @Id //PK ì„ì„ í‘œì‹œ
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    //@Column(name = "user_name") ì»¬ëŸ¼ëª…ê³¼ í•„ë“œ ì´ë¦„ì´ ê°™ìœ¼ë©´ ì•ˆí•´ë„ëœë‹¤.
    private String name;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

<br/>

# ğŸ’¡ 9-4 JPA íšŒì› ë¦¬í¬ì§€í† ë¦¬

## **EntityManager**

```java
private final EntityManager em;

public JpaMemberRepository(EntityManager em) {
    this.em = em;
}
```

JPAëŠ” EntityManagerë¡œ ëª¨ë“  ê²ƒì´ ë™ì‘í•œë‹¤.

JPA ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë°›ìœ¼ë©´ ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì£¼ê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì´ ìƒì„±ìë¡œ ì˜ì¡´ì„± ì£¼ì…ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.

<br/>

## **save(), findById()**

```java
public Member save(Member member) {
    //insert ì¿¼ë¦¬
    em.persist(member);
    return member;
}

public Optional<Member> findById(Long id) {
    //select ì¿¼ë¦¬
    Member member = em.find(Member.class, id);
    return Optional.ofNullable(member);
}
```

pk ê¸°ë°˜ì˜ ì¿¼ë¦¬ë“¤ì€ EntityManagerì—ì„œ ì œê³µí•´ì£¼ëŠ” ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ëœë‹¤.

<br/>

## **findByName(), findByAll()**

```java
public Optional<Member> findByName(String name) {
    List<Member> members = em.createQuery("select m from Member m where m.name = :name", Member.class)
            .setParameter("name", name)
            .getResultList();
    return members.stream().findAny();
}

public List<Member> findAll() {
    return em.createQuery("select m from Member m", Member.class).getResultList();
}
```

ìœ„ì™€ ê°™ì´ pk ê¸°ë°˜ì´ ì•„ë‹Œ ì¿¼ë¦¬ë“¤ì€ jpql ì–¸ì–´ë¥¼ ì‘ì„±í•´ì•¼í•œë‹¤.

jpql ì–¸ì–´ëŠ” í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ë³´ë‚´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê°ì²´(ì—”í‹°í‹°)ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ë³´ë‚¸ë‹¤.

<br/>

## **ì „ì²´ ì½”ë“œ**

```java
public class JpaMemberRepository implements MemberRepository {

    private final EntityManager em;

    public JpaMemberRepository(EntityManager em) {
        this.em = em;
    }

    @Override
    public Member save(Member member) {
        em.persist(member);
        return member;
    }

    @Override
    public Optional<Member> findById(Long id) {
        Member member = em.find(Member.class, id);
        return Optional.ofNullable(member);
    }

    @Override
    public Optional<Member> findByName(String name) {
        List<Member> members = em.createQuery("select m from Member m where m.name = :name", Member.class)
                .setParameter("name", name)
                .getResultList();

        return members.stream().findAny();
    }

    @Override
    public List<Member> findAll() {
        return em.createQuery("select m from Member m", Member.class).getResultList();
    }
}
```

<br/>

# ğŸ’¡ 9-5 ì„œë¹„ìŠ¤ ê³„ì¸µì— íŠ¸ëœì­ì…˜ ì¶”ê°€

```java
@Transactional
public class MemberService {
    ...
}
```

* `org.springframework.transaction.annotation.Transactional`ë¥¼ ì‚¬ìš©í•œë‹¤.
* ìŠ¤í”„ë§ì€ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•  ë•Œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³ , ë©”ì„œë“œê°€ ì •ìƒ ì¢…ë£Œë˜ë©´ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤. ë§Œì•½ ëŸ°íƒ€ì„ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ë¡¤ë°±í•œë‹¤.
* JPAë¥¼ í†µí•œ ëª¨ë“  ë°ì´í„° ë³€ê²½ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì‹¤í–‰í•´ì•¼ í•œë‹¤.

<br/>

# ğŸ’¡ 9-6 JPAë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìŠ¤í”„ë§ ì„¤ì • ë³€ê²½

```java
@Configuration
public class SpringConfig {

    private final EntityManager em;

    @Autowired // ìƒëµ ê°€ëŠ¥
    public SpringConfig(EntityManager em) {
        this.em = em;
    }

    private final MemberRepository memberRepository;

    @Autowired
    public SpringConfig(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }


    @Bean
    public MemberService memberService(){
        return new MemberService(memberRepository);
    }


    @Bean
    public MemberRepository memberRepository(){
        return new JpaMemberRepository(em);
    }
}
```

<br/>

# ì°¸ê³ 
* [ì¸í”„ëŸ° ìŠ¤í”„ë§ ì…ë¬¸ - ì½”ë“œë¡œ ë°°ìš°ëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸, ì›¹ MVC, DB ì ‘ê·¼ ê¸°ìˆ ](https://www.inflearn.com)