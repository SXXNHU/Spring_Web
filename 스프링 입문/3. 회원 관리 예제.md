 # ìŠ¤í”„ë§ ì…ë¬¸ ì •ë¦¬ #3

## âœ” ëª©í‘œ
ê°„ë‹¨í•œ íšŒì› ê´€ë¦¬ ì˜ˆì œë¥¼ ë§Œë“¤ì–´ë³´ì.

<br/>

## âœ” ëª©ì°¨
* ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ì •ë¦¬
* íšŒì› ë„ë©”ì¸ê³¼ ë¦¬í¬ì§€í† ë¦¬ ë§Œë“¤ê¸°
* íšŒì› ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±
* íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ
* íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸

<br/>

## ğŸ’¡ 3-1 ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ì •ë¦¬

êµ¬í˜„í•  íšŒì› ê´€ë¦¬ ì˜ˆì œì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

* ë°ì´í„° : íšŒì›ID, ì´ë¦„
* ê¸°ëŠ¥ : íšŒì› ë“±ë¡(ì´ë¦„ ì¤‘ë³µ í™•ì¸ë„ ì§„í–‰), ì¡°íšŒ
* ë°ì´í„° ì €ì¥ : ë©”ëª¨ë¦¬ ê¸°ë°˜ì˜ ë°ì´í„° ì €ì¥ì†Œ

ì¼ë°˜ì ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µê³¼ ë™ì¼í•˜ê²Œ ë‹¤ìŒê³¼ ê°™ì´ 4ê°€ì§€ë¡œ ë‚˜ëˆˆë‹¤.

* ì»¨íŠ¸ë¡¤ëŸ¬(Controller) : ì›¹ MVCì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ì—­í• 
* ì„œë¹„ìŠ¤(Service): í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
* ë¦¬í¬ì§€í† ë¦¬(Repository) : ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼, ë„ë©”ì¸ ê°ì²´ë¥¼ DBì— ì €ì¥í•˜ê³  ê´€ë¦¬
* ë„ë©”ì¸(Domain) : ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê°ì²´, ì˜ˆ) íšŒì›, ì£¼ë¬¸, ì¿ í° ë“±ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ê³¼ ë™ì¼

<br/>

## ğŸ’¡ 3-2 íšŒì› ë„ë©”ì¸ê³¼ ë¦¬í¬ì§€í† ë¦¬ ë§Œë“¤ê¸°

### ğŸ“Œ **ë„ë©”ì¸(Domain)**

```java
public class Member {
    private Long id;
    private String name;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

ë„ë©”ì¸ì— idì™€ nameì„ ê°–ëŠ” ë§´ë²„ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ì¤€ë‹¤. ë‚˜ì¤‘ì— ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ê³¼ ë§¤í•‘ë  ì˜ˆì •ì´ë‹¤.

<br/>

### ğŸ“Œ **ë¦¬í¬ì§€í† ë¦¬(Repository)**

```java
public interface MemberRepository {
    Member save(Member member);
    Optional<Member> findById(Long id);
    Optional<Member> findByName(String name);
    List<Member> findAll();
}
```

findByIdì™€ findByNameì€ nullê°’ì¼ ê²½ìš°ê°€ ì¡´ì¬í•˜ê¸° ë–„ë¬¸ì— Optionalë¡œ ê°ì‹¸ì¤€ë‹¤. NullPointerExceptionì„ í”¼í•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ ë©”ì†Œë“œë“¤ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•¨ì´ë‹¤.

<br/>

### ğŸ“Œ **ë©”ëª¨ë¦¬ ë¦¬í¬ì§€í† ë¦¬(Memory Repository)**

```java
public class MemoryMemberRepository implements MemberRepository{

    private static Map<Long, Member> store = new HashMap<>();
    private static Long sequence = 0L;

    @Override
    public Member save(Member member) {
        member.setId(++sequence);
        store.put(member.getId(), member);
        return member;
    }

    @Override
    public Optional<Member> findById(Long id) {
        return Optional.ofNullable(store.get(id));
    }

    @Override
    public Optional<Member> findByName(String name) {
        return store.values().stream()
                .filter(member -> member.getName().equals(name))
                .findAny();
    }

    @Override
    public List<Member> findAll() {
        return new ArrayList<>(store.values());
    }

    public void clearStore(){
        store.clear();
    }
}
```

storeê³¼ sequenceëŠ” static ë³€ìˆ˜ë¡œ ì„ ì–¸í•œë‹¤. íšŒì› ì •ë³´ë¥¼ ë‹´ê³ ìˆëŠ” storeê°€ í”„ë¡œê·¸ë¨ì´ ëë‚  ë•Œ ê¹Œì§€ ê·¸ ê°’ì„ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ê¸° ìœ„í•¨ì´ë‹¤.

<br/>

## ğŸ’¡ 3-3 ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±

```java
class MemoryMemberRepositoryTest {

    MemoryMemberRepository repository = new MemoryMemberRepository();

    @AfterEach
    void clear(){
        repository.clearStore();
    }
    @Test
    void save() {
        Member member = new Member();
        member.setName("í™ê¸¸ë™");

        repository.save(member);


        Member result = repository.findById(member.getId()).get();

        assertEquals(member, result);
    }

    @Test
    void findById() {
        Member member1 = new Member();
        member1.setName("í™ê¸¸ë™");

        Member member2 = new Member();
        member2.setName("ê¹€ì² ìˆ˜");

        repository.save(member1);
        repository.save(member2);

        Member result = repository.findById(member2.getId()).get();

        assertEquals(member2, result);
    }

    @Test
    void findByName() {
        Member member1 = new Member();
        member1.setName("í™ê¸¸ë™");

        Member member2 = new Member();
        member2.setName("ê¹€ì² ìˆ˜");

        repository.save(member1);
        repository.save(member2);

        Member result = repository.findByName(member2.getName()).get();

        assertEquals(member2, result);
    }

    @Test
    void findAll() {
        Member member1 = new Member();
        member1.setName("í™ê¸¸ë™");

        Member member2 = new Member();
        member2.setName("ê¹€ì² ìˆ˜");

        repository.save(member1);
        repository.save(member2);

        List<Member> result = repository.findAll();

        assertEquals(2, result.size());
    }
}
```

<br/>

## ğŸ’¡ 3-4 íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ

```java
public class MemberService {

    private final MemberRepository memberRepository;

    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    /**
     * íšŒì› ê°€ì…
     */
    public Long join(Member member){
        //ì¤‘ë³µ íšŒì› í™•ì¸
        validateDuplicateMember(member);

        memberRepository.save(member);
        return member.getId();
    }

    private void validateDuplicateMember(Member member) {
        memberRepository.findByName(member.getName())
                .ifPresent(m -> {
                    throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
                });
    }

    /**
     * ì „ì²´ íšŒì› ì¡°íšŒ
     */
    public List<Member> findMembers(){
        return memberRepository.findAll();
    }

    /**
     * íŠ¹ì • íšŒì› ì¡°íšŒ
     */
    public Optional<Member> findOne(Long memberId){
        return memberRepository.findById(memberId);
    }
}
```

<br/>

## ğŸ’¡ 3-5 íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸

```java
class MemberServiceTest {

    MemberService memberService;
    MemoryMemberRepository memberRepository;

    @BeforeEach
    void beforeEach(){
        memberRepository = new MemoryMemberRepository();
        memberService = new MemberService(memberRepository);
    }

    @AfterEach
    void afterEach(){
        memberRepository.clearStore();
    }

    @Test
    void íšŒì›ê°€ì…() {
        //given
        Member member = new Member();
        member.setName("í™ê¸¸ë™");

        //when
        memberService.join(member);

        //then
        assertEquals(member, memberService.findOne(member.getId()).get());
    }

    @Test
    void ì¤‘ë³µ_íšŒì›_ì˜ˆì™¸() {
        //given
        Member member1 = new Member();
        member1.setName("í™ê¸¸ë™");
        Member member2 = new Member();
        member2.setName("í™ê¸¸ë™");

        //when
        memberService.join(member1);

        //then
        IllegalStateException e = assertThrows(IllegalStateException.class, () -> memberService.join(member2));
        assertEquals(e.getMessage(), "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
    }
}
```

**@BeforeEach** : ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ì— í˜¸ì¶œëœë‹¤. í…ŒìŠ¤íŠ¸ê°€ ì„œë¡œ ì˜í–¥ì´ ì—†ë„ë¡ ë§¤ë²ˆ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ ,
ì˜ì¡´ê´€ê³„ë„ ìƒˆë¡œ ë§ºì–´ì¤€ë‹¤.

<br/>

# ì°¸ê³ 
* [ì¸í”„ëŸ° ìŠ¤í”„ë§ ì…ë¬¸ - ì½”ë“œë¡œ ë°°ìš°ëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸, ì›¹ MVC, DB ì ‘ê·¼ ê¸°ìˆ ](https://www.inflearn.com)